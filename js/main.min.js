var locData={lat:"",lon:"",postcode:"",city:"",countrycode:""};var imgData={current:0,max:"",small_url:"images/default/small.jpg",big_url:"images/default/big.jpg",};var icons={snow:'<svg viewBox="0 0 512 512"><path class="svgIcon" d="M153,387h-16.2l0,0c-0.2,0,0.2,0,0,0c-45,0-80.8-36.7-80.8-81.6s36.5-81.5,81.4-81.5c3.9,0,7.8,0.2,11.6,0.8c13.9-56.9,65.3-99.2,126.6-99.2c72,0,130.3,58.3,130.3,130.3c0,10.6-1.3,20.9-3.7,30.7c1.2-0.1,2.4,0,3.7,0c27.6-0.1,50.1,22.5,50.1,50.2s-22.5,50.4-50.2,50.4H393"/><g><line class="svgIcon" x1="219" y1="342" x2="219" y2="431"/><line class="svgIcon" x1="180.6" y1="408.7" x2="257.6" y2="364.3"/><line class="svgIcon" x1="257.6" y1="408.7" x2="180.6" y2="364.3"/></g><g><line class="svgIcon" x1="329" y1="342" x2="329" y2="431"/><line class="svgIcon" x1="290.6" y1="408.7" x2="367.6" y2="364.3"/><line class="svgIcon" x1="367.6" y1="408.7" x2="290.6" y2="364.3"/></g></svg>',partlycloudy:'<svg viewBox="-452 453.3 512 512"><g><path class="svgIcon" d="M4.1,821.2c0,21.5-17.4,39.2-38.8,39.2h-208.2c-34.8,0-62.4-28.5-62.4-63.3c0-14.6,5-28.1,13.4-38.8c11.5-14.8,29.4-24.3,49.6-24.3c3,0,6,0.1,8.9,0.5c6.3-25.8,22.5-47.6,44.3-61.4c15.5-9.8,33.9-15.4,53.6-15.4c55.7,0,100.8,45.1,100.8,100.8c0,8.2-1,16.1-2.8,23.8c0.9-0.1,1.9,0.1,2.8,0.1C-13.3,782.2,4.1,799.7,4.1,821.2z"/><path class="svgIcon" d="M-189.1,673.1c-21.8,13.7-38,35.6-44.3,61.4c-2.9-0.4-5.9-0.5-8.9-0.5c-20.2,0-38.1,9.6-49.6,24.4c-23-12.1-38.7-36.3-38.7-64.1c0-40,32.4-72.4,72.4-72.4C-225.6,621.8-198.1,643.3-189.1,673.1z"/><line class="svgIcon" x1="-258" y1="558.3" x2="-258" y2="596.3"/><line class="svgIcon" x1="-396" y1="695.3" x2="-358" y2="695.3"/><line class="svgIcon" x1="-190.4" y1="627.5" x2="-162.5" y2="599.6"/><line class="svgIcon" x1="-358.2" y1="790.4" x2="-330.3" y2="762.5"/><line class="svgIcon" x1="-358.2" y1="599.6" x2="-330.3" y2="627.5"/></g></svg>',sunny:'<svg viewBox="-452 453.3 512 512"><g><circle class="svgIcon" cx="-196.1" cy="709.8" r="105.7"/><line class="svgIcon" x1="-197" y1="511.3" x2="-197" y2="568.3"/><line class="svgIcon" x1="-396" y1="709.3" x2="-338" y2="709.3"/><line class="svgIcon" x1="-53" y1="709.3" x2="4" y2="709.3"/><line class="svgIcon" x1="-197" y1="850.3" x2="-197" y2="907.3"/><line class="svgIcon" x1="-97" y1="612.4" x2="-56.2" y2="571.7"/><line class="svgIcon" x1="-97" y1="809.5" x2="-56.2" y2="850.3"/><line class="svgIcon" x1="-342" y1="850.3" x2="-301.2" y2="809.5"/><line class="svgIcon" x1="-342" y1="571.7" x2="-301.2" y2="612.4"/></g></svg>',clouds:'<svg viewBox="-452 453.3 512 512"><path class="svgIcon" d="M4,790c0,27.7-22.5,50.4-50.2,50.4h-269.1l0,0c-0.2,0,0.2,0,0,0c-45,0-80.8-36.7-80.8-81.6s36.5-81.5,81.4-81.5c3.9,0,7.8,0.2,11.6,0.8c13.9-56.9,65.3-99.2,126.6-99.2c72,0,130.3,58.3,130.3,130.3c0,10.6-1.3,20.9-3.7,30.7c1.2-0.1,2.4,0,3.7,0C-18.5,739.7,4,762.3,4,790z"/></svg>',rain:'<svg viewBox="-452 453.3 512 512"><path class="svgIcon" d="M-248,840.3h-67.2l0,0c-0.2,0,0.2,0,0,0c-45,0-80.8-36.7-80.8-81.6s36.5-81.5,81.4-81.5c3.9,0,7.8,0.2,11.6,0.8c13.9-56.9,65.3-99.2,126.6-99.2c72,0,130.3,58.3,130.3,130.3c0,10.6-1.3,20.9-3.7,30.7c1.2-0.1,2.4,0,3.7,0C-18.5,739.7,4,762.3,4,790s-22.5,50.4-50.2,50.4H-120"/><g><line class="svgIcon" x1="-159" y1="786.3" x2="-159" y2="830.3"/><line class="svgIcon" x1="-159" y1="849.3" x2="-159" y2="893.3"/></g><g><line class="svgIcon" x1="-209" y1="786.3" x2="-209" y2="830.3"/><line class="svgIcon" x1="-209" y1="849.3" x2="-209" y2="893.3"/></g></svg>',thunder:'<svg viewBox="-452 453.3 512 512"><path class="svgIcon" d="M-253,840.3h-62.2l0,0c-0.2,0,0.2,0,0,0c-45,0-80.8-36.7-80.8-81.6s36.5-81.5,81.4-81.5c3.9,0,7.8,0.2,11.6,0.8c13.9-56.9,65.3-99.2,126.6-99.2c72,0,130.3,58.3,130.3,130.3c0,10.6-1.3,20.9-3.7,30.7c1.2-0.1,2.4,0,3.7,0C-18.5,739.7,4,762.3,4,790s-22.5,50.4-50.2,50.4H-114"/><polygon class="svgIcon" points="-165.3,724 -236.3,824.6 -177.1,851.2 -215.6,939.8 -132.7,842.4 -194.9,806.9 "/></svg>',foggy:'<svg viewBox="-452 453.3 512 512"><g><line class="svgIcon" x1="-396" y1="597.3" x2="4" y2="597.3"/><line class="svgIcon" x1="-396" y1="672.3" x2="-216" y2="672.3"/><line class="svgIcon" x1="-396" y1="747.3" x2="-216" y2="747.3"/><line class="svgIcon" x1="-396" y1="822.3" x2="4" y2="822.3"/><line class="svgIcon" x1="-176" y1="672.3" x2="4" y2="672.3"/><line class="svgIcon" x1="-176" y1="747.3" x2="4" y2="747.3"/></g></svg>'}
window.onload=function(){init()}
function init(){setImage(imgData.small_url,imgData.big_url);getLocation();setInterval(function(){update()},(40000))}
function update(){getLocation()}
function setImage(small,big){document.getElementById('contentImage').src=big;document.getElementById('blurImage').src=small;document.getElementById('contentImage').onload=function(){setColor()}}
function setLocationData(city,country){document.getElementsByTagName('location')[0].innerHTML=city+", "+country}
function setColor(){var sourceImage=document.getElementById("contentImage");if(sourceImage.src!=""||sourceImage!=null){var colorThief=new ColorThief();var color=colorThief.getColor(sourceImage);if(color.length==3){if((color[0]*0.299+color[1]*0.587+color[1]*0.114)>186){document.documentElement.style.setProperty('--contentFontColor','black')}else{document.documentElement.style.setProperty('--contentFontColor','white')}}}}
function getIcon(icon){var tempIcon;switch(icon){case '01d':case '01n':tempIcon=icons.sunny;break;case '02d':case '02n':tempIcon=icons.partlycloudy;break;case '03d':case '03n':case '04d':case '04n':tempIcon=icons.clouds;break;case '09d':case '09n':case '10d':case '10n':tempIcon=icons.rain;break;case '11d':case '11n':tempIcon=icons.thunder;break;case '13d':case '13n':tempIcon=icons.snow;break;case '50d':case '50n':tempIcon=icons.foggy;break}
return tempIcon}
function setWeatherData(wd){var forecast=document.getElementsByTagName("forecast")[0];var now=document.getElementsByTagName("now")[0];now.getElementsByTagName("description")[0].innerHTML=wd[0].text;now.getElementsByTagName("temp")[0].getElementsByTagName("div")[0].innerHTML=wd[0].temp+"&deg;C";now.getElementsByTagName("icon")[0].innerHTML=getIcon(wd[0].icon);for(var i=0;i<forecast.getElementsByTagName("item").length;i++){forecast.getElementsByTagName("item")[i].getElementsByTagName("day")[0].innerHTML=wd[(i+1)].day;forecast.getElementsByTagName("item")[i].getElementsByTagName("icon")[0].innerHTML=getIcon(wd[(i+1)].icon)}}
function getLocation(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(getLocationCoords,showError)}else{console.log("Geolocation is not supported by this browser.")}}
function getLocationCoords(position){locData={lat:position.coords.latitude,lon:position.coords.longitude}
getLocationData(locData)}
function getLocationData(pos){var request=new XMLHttpRequest();request.open('POST','https://nominatim.openstreetmap.org/reverse?format=json&lat='+pos.lat+'&lon='+pos.lon+'&zoom=18&addressdetails=1',!0);request.onload=function(){if(request.status>=200&&request.status<400){var data=JSON.parse(request.responseText);var city;if(data.address.city==undefined&&data.address.village==undefined){city=data.address.town}else if(data.address.city==undefined&&data.address.town==undefined){city=data.address.village}else if(data.address.town==undefined&&data.address.village==undefined){city=data.address.city}
locData.postcode=data.address.postcode;locData.city=city;locData.countrycode=data.address.country_code.toUpperCase();setLocationData(locData.city,locData.countrycode);getImageData(pos,locData.city);getWeatherData(pos)}else{error=1}};request.onerror=function(){error=1};request.send()}
function getImgUrl(obj){var size={small:'m',big:'z'}
var o={small:'https://farm'+obj.farm+'.staticflickr.com/'+obj.server+'/'+obj.id+'_'+obj.secret+'_'+size.small+'.jpg',big:'https://farm'+obj.farm+'.staticflickr.com/'+obj.server+'/'+obj.id+'_'+obj.secret+'_'+size.big+'.jpg'}
return o}
function getImageData(pos,text){if(text==undefined){text=""}
var request=new XMLHttpRequest();request.open('POST','https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=6dd6bbd80c2440fe099eacc50cee6d02&sort=relevance&has_geo=1&text='+text+'&lat='+pos.lat+'&lon='+pos.lon+'&format=json&nojsoncallback=1',!0);request.onload=function(){if(request.status>=200&&request.status<400){var data=JSON.parse(request.responseText);imgData.max=data.photos.photo.length;if(imgData.current<imgData.max){imgData.current++}else{imgData.current=0}
var tempData={id:data.photos.photo[imgData.current].id,secret:data.photos.photo[imgData.current].secret,server:data.photos.photo[imgData.current].server,farm:data.photos.photo[imgData.current].farm}
var url=getImgUrl(tempData);setImage(url.small,url.big)}else{error=1}};request.onerror=function(){error=1};request.send()}
function getWeatherData(pos){var request=new XMLHttpRequest();request.open('POST','https://api.openweathermap.org/data/2.5/forecast/daily?lat='+pos.lat+'&lon='+pos.lon+'&appid=4e63aee7429c7b030cf2944931ad8753&lang=de&units=metric&cnt=5',!0);request.onload=function(){if(request.status>=200&&request.status<400){var data=JSON.parse(request.responseText);var weather=[];var days=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];for(var i=0;i<data.list.length;i++){var tempDay=days[new Date(data.list[i].dt*1000).getDay()];if(i==1)
tempDay="Morgen";weather.push({date:new Date(data.list[i].dt*1000),day:tempDay,icon:data.list[i].weather[0].icon,temp:Math.round(data.list[i].temp.day),text:data.list[i].weather[0].description})}
setWeatherData(weather)}else{error=1}};request.onerror=function(){error=1};request.send()}
function showError(error){switch(error.code){case error.PERMISSION_DENIED:console.log("User denied the request for Geo-location.");break;case error.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case error.TIMEOUT:console.log("The request to get user location timed out.");break;case error.UNKNOWN_ERROR:console.log("An unknown error occurred.");break}}